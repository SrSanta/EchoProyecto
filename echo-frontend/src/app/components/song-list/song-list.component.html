<div class="song-list-container">
  @if (loading) {
    <div class="loading-message">
      <span class="blink">‚è≥</span> Cargando canciones...
    </div>
  } @else {
    @if (error) {
      <div class="error-message">
        ‚ö†Ô∏è {{ error }}
        <button (click)="error = null" class="close-btn">‚úï</button>
      </div>
    } @else {
      @if (songs.length > 0) {
        <h2>üéµ Lista de canciones</h2>
        <div class="song-list-window">
          <ul>
            @for (song of songs; track song.id) {
              <li class="song-item" (contextmenu)="onSongContextMenu($event, song.id); $event.preventDefault()">
                <div (click)="playSong(song)" class="song-content">
                  <div class="song-thumbnail">
                    @if (song.thumbnailFilename) {
                      <img [src]="environment.apiUrl + '/api/thumbnails/' + song.thumbnailFilename.replace('thumbnail/', '')" 
                           [alt]="'Portada de ' + song.title" 
                           class="song-thumbnail-small">
                    } @else {
                      <img src="assets/images/placeholder-thumbnail.png" 
                           alt="Sin portada" 
                           class="song-thumbnail-small">
                    }
                  </div>
                  <div class="song-info">
                    <div class="song-title">{{ song.title }}</div>
                    <div class="song-details">
                      <span class="song-artist">üë§ {{ song.user.username }}</span>
                      <span class="song-separator">‚Ä¢</span>
                      <span class="song-genre">üéµ {{ song.genre.name }}</span>
                    </div>
                  </div>
                </div>
              </li>
            }
          </ul>
        </div>
      } @else {
        <div class="empty-message">
          <p>üì≠ No hay canciones disponibles</p>
          <p class="small">¬°S√© el primero en subir una canci√≥n!</p>
        </div>
      }
    }
  }
</div>

<!-- Men√∫ contextual para a√±adir a playlist -->
<app-context-menu
  #contextMenu
  *ngIf="showContextMenu && selectedSongId !== null"
  [show]="showContextMenu"
  [position]="contextMenuPosition"
  [playlists]="userPlaylists"
  [songId]="selectedSongId"
  (addToPlaylist)="onAddToPlaylistHandler($event)"
  (addToQueue)="onAddToQueueFromContextMenu($event)"
  (closeMenu)="showContextMenu = false">
</app-context-menu>

<!-- Mensaje de error del men√∫ contextual -->
@if (contextMenuError) {
  <div class="context-menu-error window">
    <div class="window-titlebar">
      <span>Error</span>
      <button (click)="contextMenuError = null" class="close-btn">‚úï</button>
    </div>
    <div class="window-content">
      <p>‚ö†Ô∏è {{ contextMenuError }}</p>
    </div>
  </div>
}
