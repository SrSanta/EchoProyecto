<div class="cd-player">
  <div class="cd-player-header">
    <div class="cd-player-title">ECHO PLAYER</div>
  </div>
  
  @if (song) {
    <div class="cd-player-display">
      <div class="track-info">
        <div class="track-number">[{{ currentTrackNumber || '--' }}]</div>
        <div class="time-display">{{ currentTime || '00:00' }}</div>
      </div>
      
      <div class="cd-player-artist">
        <span class="label">Artist:</span>
        <div class="value">{{ song.user.username || 'Unknown' }}</div>
      </div>
      
      <div class="cd-player-title">
        <span class="label">Title:</span>
        <div class="value">{{ song.title || 'No title' }}</div>
      </div>
      

    </div>
    
    <div class="cd-player-controls">
      <button class="control-btn" (click)="playPrevious()" title="Previous">
        <span class="icon">‚èÆ</span>
      </button>
      <button class="control-btn" (click)="playOrPause()" [class.playing]="isPlaying" title="Play/Pause">
        <span class="icon">{{ isPlaying ? '‚è∏' : '‚ñ∂' }}</span>
      </button>
      <button class="control-btn" (click)="stopPlayback()" title="Stop">
        <span class="icon">‚èπ</span>
      </button>
      <button class="control-btn" (click)="playNext()" title="Next">
        <span class="icon">‚è≠</span>
      </button>
      <button class="control-btn eject" (click)="eject()" title="Eject">
        <span class="icon">‚èè</span>
      </button>
      
      <div class="progress-container">
        <div class="progress-bar" [style.width.%]="progressPercentage"></div>
      </div>
    </div>
    
    <div class="cd-player-status">
      <div class="status-item">
        <span class="label">Total:</span>
        <span class="value">{{ formatTime(duration) || '--:--' }}</span>
      </div>
      <div class="status-item">
        <span class="label">Track:</span>
        <span class="value">{{ currentTime || '00:00' }}</span>
      </div>
    </div>
    
    @if (userId !== null) {
      <div class="like-button">
        <button (click)="toggleLike()" [class.liked]="isLiked">
          {{ isLiked ? 'üíî Unlike' : '‚ù§Ô∏è Like' }}
        </button>
      </div>
    } @else {
      <div>
        <p>Inicia sesi√≥n para dar 'Me gusta'.</p>
        <a routerLink="/login">Iniciar Sesi√≥n</a>
      </div>
    }
  } @else {
    <div class="no-song">
      <div class="cd-player-display">
        <div class="no-song-message">NO DISC</div>
        <div class="no-song-sub">Insert a song to begin</div>
      </div>
    </div>
  }
  
  <!-- Contenedor de la cola de reproducci√≥n -->
  <div class="queue-container">
    <button class="queue-toggle" (click)="showQueue = !showQueue">
      {{ showQueue ? '‚ñ≤ Ocultar cola' : '‚ñº Mostrar cola' }}
    </button>
    <div class="playback-queue-panel" [class.visible]="showQueue">
      <app-playback-queue></app-playback-queue>
    </div>
  </div>
</div>

<audio #audioPlayer 
       [src]="audioUrl" 
       (timeupdate)="updateProgress()" 
       (loadedmetadata)="onMetadataLoaded()"
       (play)="onPlay()"
       (pause)="onPause()"
       (ended)="onSongEnded()"
       style="display: none;">
  Your browser does not support the audio element.
</audio>
